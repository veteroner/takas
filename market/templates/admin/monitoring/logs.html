{% extends "admin/base_site.html" %}
{% load static %}

{% block title %}Sistem Loglarƒ±{% endblock %}

{% block extrahead %}
<style>
.logs-container {
    margin: 20px;
}

.log-files-list {
    background: #f5f5f5;
    padding: 15px;
    border-radius: 4px;
    margin: 20px 0;
}

.log-viewer {
    background: #000;
    color: #0f0;
    font-family: 'Courier New', monospace;
    font-size: 12px;
    padding: 20px;
    border-radius: 4px;
    height: 500px;
    overflow-y: auto;
    white-space: pre-wrap;
    margin: 20px 0;
}

.log-controls {
    margin: 20px 0;
}

.log-controls button {
    margin: 5px;
    padding: 8px 16px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    background-color: #2196f3;
    color: white;
}

.log-controls button:hover {
    background-color: #1976d2;
}

.log-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin: 20px 0;
}

.stat-card {
    background: #fff;
    border: 1px solid #ddd;
    border-radius: 4px;
    padding: 15px;
    text-align: center;
}

.stat-value {
    font-size: 24px;
    font-weight: bold;
    color: #2e7d32;
}

.stat-label {
    color: #666;
    font-size: 14px;
}
</style>
{% endblock %}

{% block content %}
<div class="logs-container">
    <h1>üìù Sistem Loglarƒ±</h1>
    
    {% if error %}
        <div class="alert alert-error">
            <strong>Hata:</strong> {{ error }}
        </div>
    {% endif %}

    <!-- Log Statistics -->
    <div class="log-stats">
        <div class="stat-card">
            <div class="stat-value">{{ log_files|length }}</div>
            <div class="stat-label">Log Dosyasƒ±</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ recent_logs|length }}</div>
            <div class="stat-label">Son Kayƒ±tlar</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">Live</div>
            <div class="stat-label">Monitoring</div>
        </div>
    </div>

    <!-- Log Controls -->
    <div class="log-controls">
        <button onclick="refreshLogs()">üîÑ Yenile</button>
        <button onclick="downloadLogs()">‚¨áÔ∏è ƒ∞ndir</button>
        <button onclick="clearLogs()">üßπ Temizle</button>
        <button onclick="toggleAutoRefresh()" id="autoRefreshBtn">‚ñ∂Ô∏è Otomatik Yenileme</button>
    </div>

    <!-- Available Log Files -->
    {% if log_files %}
        <div class="log-files-list">
            <h3>üìÇ Mevcut Log Dosyalarƒ±:</h3>
            <ul>
                {% for log_file in log_files %}
                    <li><a href="#" onclick="loadLogFile('{{ log_file }}')">{{ log_file }}</a></li>
                {% endfor %}
            </ul>
        </div>
    {% endif %}

    <!-- Log Viewer -->
    <div class="log-viewer" id="log-viewer">
        {% if recent_logs %}
            {% for log_line in recent_logs %}
{{ log_line }}{% endfor %}
        {% else %}
            [INFO] Log viewer ba≈ülatƒ±ldƒ±
            [INFO] Sistem loglarƒ± y√ºkleniyor...
            [INFO] Monitoring aktif: Real-time log takibi
            [WARNING] Log dosyasƒ± bulunamadƒ±, varsayƒ±lan mesajlar g√∂steriliyor
        {% endif %}
    </div>
</div>

<script>
let autoRefreshEnabled = false;
let autoRefreshInterval;

function refreshLogs() {
    // Refresh current page
    window.location.reload();
}

function downloadLogs() {
    // Create downloadable log file
    const logContent = document.getElementById('log-viewer').textContent;
    const blob = new Blob([logContent], { type: 'text/plain' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'system-logs-' + new Date().toISOString().slice(0, 10) + '.txt';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    window.URL.revokeObjectURL(url);
}

function clearLogs() {
    if (confirm('T√ºm loglar temizlensin mi? Bu i≈ülem geri alƒ±namaz.')) {
        // In a real implementation, this would call an API endpoint
        document.getElementById('log-viewer').textContent = '[INFO] Loglar temizlendi\n[INFO] Yeni log kayƒ±tlarƒ± buraya gelecek\n';
    }
}

function toggleAutoRefresh() {
    const btn = document.getElementById('autoRefreshBtn');
    
    if (autoRefreshEnabled) {
        // Stop auto refresh
        clearInterval(autoRefreshInterval);
        autoRefreshEnabled = false;
        btn.textContent = '‚ñ∂Ô∏è Otomatik Yenileme';
        btn.style.backgroundColor = '#2196f3';
    } else {
        // Start auto refresh
        autoRefreshInterval = setInterval(refreshLogs, 10000); // Every 10 seconds
        autoRefreshEnabled = true;
        btn.textContent = '‚è∏Ô∏è Otomatik Yenileme';
        btn.style.backgroundColor = '#f44336';
    }
}

function loadLogFile(filename) {
    // In a real implementation, this would load the specific log file
    const viewer = document.getElementById('log-viewer');
    viewer.textContent = `[INFO] Loading log file: ${filename}\n[INFO] Log content would be displayed here\n`;
}

// Auto-scroll to bottom of log viewer
function scrollToBottom() {
    const viewer = document.getElementById('log-viewer');
    viewer.scrollTop = viewer.scrollHeight;
}

// Initialize
document.addEventListener('DOMContentLoaded', function() {
    scrollToBottom();
});
</script>
{% endblock %}
