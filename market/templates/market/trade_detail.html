{% extends "market/base.html" %}
{% block content %}
  <div style="text-align:center;margin-bottom:30px;">
    <h1 style="color:white;margin:0;">🔄 Takas Detayı</h1>
  </div>
  
  <div class="card">
    <div style="display:grid;grid-template-columns:1fr auto 1fr;gap:30px;align-items:center;margin-bottom:30px;">
      <div style="text-align:center;padding:20px;background:#f7fafc;border-radius:15px;">
        <h3 style="margin:0 0 12px 0;color:#2d3748;">{{ trade.offered_item.title }}</h3>
        <p style="color:#667eea;font-weight:600;margin:0;">📤 {{ trade.requester.first_name|default:trade.requester.username }}</p>
        <small style="color:#718096;">Teklif Eden</small>
      </div>
      
      <div style="text-align:center;font-size:32px;">
        {% if trade.status == 'pending' %}⏳
        {% elif trade.status == 'accepted' %}✅
        {% elif trade.status == 'rejected' %}❌
        {% else %}⭕
        {% endif %}
      </div>
      
      <div style="text-align:center;padding:20px;background:#f7fafc;border-radius:15px;">
        <h3 style="margin:0 0 12px 0;color:#2d3748;">{{ trade.requested_item.title }}</h3>
        <p style="color:#667eea;font-weight:600;margin:0;">📥 {{ trade.responder.first_name|default:trade.responder.username }}</p>
        <small style="color:#718096;">Ürün Sahibi</small>
      </div>
    </div>
    
    <div style="text-align:center;margin-bottom:30px;">
      <span style="
        padding:12px 24px;
        border-radius:25px;
        font-weight:600;
        font-size:16px;
        {% if trade.status == 'pending' %}background:#fef5e7;color:#c05621;
        {% elif trade.status == 'accepted' %}background:#f0fff4;color:#2f855a;
        {% elif trade.status == 'rejected' %}background:#fed7d7;color:#c53030;
        {% else %}background:#edf2f7;color:#4a5568;
        {% endif %}
      ">
        {{ trade.get_status_display }}
      </span>
    </div>
    
    {% if request.user == trade.responder and trade.status == 'pending' %}
      <div style="text-align:center;margin-bottom:30px;">
        <a class="btn" href="{% url 'market:trade_action' trade.id 'accept' %}" style="background:linear-gradient(135deg, #48bb78 0%, #38a169 100%);margin-right:12px;">✅ Kabul Et</a>
        <a class="btn danger" href="{% url 'market:trade_action' trade.id 'reject' %}">❌ Reddet</a>
      </div>
    {% elif request.user == trade.requester and trade.status == 'pending' %}
      <div style="text-align:center;margin-bottom:30px;">
        <a class="btn secondary" href="{% url 'market:trade_action' trade.id 'cancel' %}">⭕ İptal Et</a>
      </div>
    {% endif %}
  </div>

  <div class="card">
    <h3 style="color:#2d3748;margin:0 0 20px 0;">💬 Mesajlaşma</h3>
    
    <div style="max-height:400px;overflow-y:auto;padding:16px;background:#f7fafc;border-radius:12px;margin-bottom:20px;">
      {% for m in trade.messages.all %}
        <div style="
          margin-bottom:16px;
          padding:12px 16px;
          border-radius:12px;
          {% if m.sender == request.user %}
            background:#667eea;color:white;margin-left:20%;text-align:right;
          {% else %}
            background:white;margin-right:20%;
          {% endif %}
        ">
          <div style="font-weight:600;margin-bottom:4px;">
            {% if m.sender == request.user %}Sen{% else %}{{ m.sender.first_name|default:m.sender.username }}{% endif %}
          </div>
          <div>{{ m.content }}</div>
          <small style="opacity:0.7;font-size:11px;">{{ m.created_at|date:'d.m.Y H:i' }}</small>
        </div>
      {% empty %}
        <div style="text-align:center;color:#718096;padding:20px;">
          💭 Henüz mesaj yok. İlk mesajı siz gönderin!
        </div>
      {% endfor %}
    </div>
    
    <form method="post">
      {% csrf_token %}
      <div style="display:flex;gap:12px;">
        {{ form.content }}
        <button class="btn" type="submit" style="white-space:nowrap;">📤 Gönder</button>
      </div>
    </form>
  </div>
  
  <div style="text-align:center;margin-top:20px;">
    <a href="{% url 'market:trade_list' %}" class="btn outline">← Takaslarıma Dön</a>
  </div>
{% endblock %}
